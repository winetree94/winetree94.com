---
import BaseHead from "@/components/BaseHead.astro";
import BlogHeader from "@/components/BlogHeader.astro";
import Footer from "@/components/Footer.astro";
import GhostPost from "@/components/GhostPost.astro";
import type { SupportedLanguageCodes } from "@/lib/language";
import type { PostOrPage } from "@tryghost/content-api";
import TextDate from "./TextDate.astro";
import { optimizeGhostArticle } from "@/lib/ghost-article";
import { Image } from "astro:assets";

type Props = {
  /**
   * Language code
   */
  lang: SupportedLanguageCodes;

  /**
   * A Ghost Post or Page object
   */
  post: PostOrPage;

  /**
   * Whether to use comments section
   */
  useComments?: boolean;
};

const { post } = Astro.props;
const highlightedHTML = await optimizeGhostArticle(post.html || "");
---

<html lang={Astro.params.lang}>
  <head>
    <BaseHead
      title={post.title!}
      description={post.excerpt!}
      ogImageUrl={post.feature_image || undefined}
      lang={Astro.props.lang}
    />
  </head>

  <body>
    <BlogHeader lang={Astro.props.lang} />
    <main class="w-full max-w-full">
      <article>
        <Image
          class="w-full max-w-full aspect-video object-cover max-h-120"
          src={post.feature_image!}
          alt="featured image"
          inferSize={true}
        />
        <div class="max-w-[720px] m-auto px-4">
          <div class:list={["text-center py-4 flex flex-col mt-4"]}>
            <h1 class="text-4xl">{Astro.props.post.title}</h1>
            <div class="py-4">
              <TextDate
                lang={Astro.props.lang}
                date={Astro.props.post.published_at!}
              />
            </div>
            <div class="divider"></div>
          </div>
          <GhostPost>
            <Fragment set:html={highlightedHTML} />
          </GhostPost>
          {
            Astro.props.useComments && (
              <div class="mt-16">
                <script
                  is:inline
                  class="discus"
                  src="https://giscus.app/client.js"
                  data-repo="winetree94/winetree94.com"
                  data-repo-id="R_kgDOMQZteg"
                  data-category="Announcements"
                  data-category-id="DIC_kwDOMQZtes4Cg0or"
                  data-mapping={Astro.url.pathname}
                  data-strict="1"
                  data-reactions-enabled="1"
                  data-emit-metadata="0"
                  data-input-position="bottom"
                  data-theme="preferred_color_scheme"
                  data-lang={Astro.params.lang}
                  crossorigin="anonymous"
                  async
                />
              </div>
            )
          }
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
