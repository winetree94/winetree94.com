---
import { ghost } from "@/lib/ghost";
import { SUPPORTED_LANGUAGES } from "@/lib/language";
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";
import BlogArticle from "@/components/BlogArticle.astro";

export const getStaticPaths = (async () => {
  const nativePages = await Promise.all(
    Object.values(SUPPORTED_LANGUAGES).map((lang) =>
      ghost.pages
        .read({
          slug: `${lang}-else`,
        })
        .then((page) => ({
          page: page,
          slug: page.slug.replace(`${lang}-`, ""),
          lang: lang,
        })),
    ),
  );

  return nativePages.map((page) => {
    return {
      props: {
        page: page.page,
        alternativePages: nativePages,
      },
      params: {
        lang: page.lang,
      },
    };
  });
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;
---

<BlogArticle
  useAuthor={false}
  slug={"else"}
  lang={Astro.params.lang}
  post={Astro.props.page}
  alternativePosts={Astro.props.alternativePages.map((page) => ({
    slug: page.slug,
    lang: page.lang,
    post: page.page,
  }))}
/>
